<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= student.displayname %>'s Profile - NoteRoom</title>
    <meta name="description" content="<%= student.displayname %> is a HSC <%= student.collegeyear %> student at <%= student.collegeID %>. Connect today to explore their academic journey at Noteroom.">
    <link rel="stylesheet" href="/css/main-pages.css">
    <link rel="stylesheet" href="/css/user-profile.css">
    <link rel="stylesheet" href="/css/nav-section.css">
    <meta name="robots" content="index, follow">
    
    <script src="https://cdn.socket.io/socket.io-3.0.1.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/dexie@latest/dist/dexie.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js" defer></script>

    <%- include('partials/links.ejs') %>
</head>
<body>
    <%- include('side-panel', { block: 'search-bar' }) %>
    <%- include('side-panel', { block: 'left-panel' }) %> 

    <div class="middle-section">
        <div class="nav-section">
            <svg class="nav-back-btn" onclick="goPrevPage()" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="#1D1B20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>

        <div class="ms-first-row">
            <div class="profile-centered">
                <div class="user-prfl-pic-wrapper">
                    <img class="user-prfl-pic" src="<%= student.profile_pic %>" alt="Profile Picture" data-field="Profile Picture" data-name="profile_pic" 
                        <% if (!visiting) { %>
                            onclick="changeDetail(this)" data-tippy-content="Click to change picture"
                        <% } else { %>
                            onclick="showProfilePreview('<%= student.profile_pic %>')"
                        <% } %>>
                    <%- !visiting ? `
                    <button class="edit-btn prfl-pic-edit" onclick="changeDetail(this)" data-field="Profile Picture" data-name="profile_pic">
                        <svg class="edit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-2.5-9.5L20 7m-2-5L13 7" stroke="#07192D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>` : '' %>
                </div>
                
                <div class="info-items">
                    <div class="info-header">
                        <h1 class="display-name"><%= student.displayname %> 
                            <%- !visiting ? `
                            <button class="edit-btn inline-edit" onclick="changeDetail(this)" data-field="Display Name" data-name="displayname">
                                <svg class="edit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-2.5-9.5L20 7m-2-5L13 7" stroke="#07192D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>` : '' %>
                        </h1>
                    </div>
                    <div class="user-clg-wrapper">
                        <div class="user-clg" data-collegeid="<%= student.collegeID %>">
                            <p class="user-info-text" id="college-name"><%= student.collegeID %></p>
                        </div>
                    </div> 
                    <span class="user-group"><%= student.group %></span>
                </div>
            </div>
        </div>

        <div class="actions-section">
            <div class="actions-box">
                <div class="stats-section stats-left">
                    <div class="badge" data-tippy-content="<%= badge.badgeText %>">
                        <img class="badge-logo" src="/images/badges/<%= badge.badgeLogo %>" alt="Badge">
                    </div>
                    <div class="featured-note">
                        <% let featuredNotesCount = student.featured_notes.length %>
                        <% if (featuredNotesCount) { %>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21 12 17.77 5.82 21 7 14.14 2 9.27 8.91 8.26 12 2Z" fill="#FEE819" stroke="#FEE819" stroke-width="1.5"/>
                            </svg>
                            <span class="featured-text">Featured Notes <span class="featured-notes-count"><%= featuredNotesCount %></span></span>
                        <% } else { %>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21 12 17.77 5.82 21 7 14.14 2 9.27 8.91 8.26 12 2Z" stroke="#666" stroke-width="1.5"/>
                            </svg>
                            <span class="featured-text">No featured notes</span>
                        <% } %>
                    </div>
                </div>
                <div class="user-profile-interaction-container stats-right">
                    <% if (visiting) { %>
                        <button 
                            class="user-profile-request-btn db-note-card-request-option"
                            data-req-pfp="<%= student.profile_pic %>" 
                            data-req-dn="<%= student.displayname %>" 
                            data-req-un="<%= student.username%>"
                        >
                            Request
                        </button>
                    <% } %>
                    <button class="share-btn share-user-profile">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92zM18 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM6 13c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 7.02c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" fill="#07192D"/>
                        </svg>
                    </button>    
                </div>
            </div>
        </div>
        
        <div class="ms-personal-info-container">
            <div class="p-info__first-row">
                <div class="user-bio-wrapper">
                    <span class="input-label">Bio</span>
                    <p class="user-info-text changable" data-field="Bio" data-name="bio"><%= student.bio || "Not Provided" %> 
                        <%- !visiting ? `
                        <button class="edit-btn inline-edit" onclick="changeDetail(this)" data-field="Bio" data-name="bio">
                            <svg class="edit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-2.5-9.5L20 7m-2-5L13 7" stroke="#07192D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>` : '' %>
                    </p>
                </div>
            </div>
            <div class="p-info__second-row">
                <div class="user-clg-year-wrapper">
                    <span class="input-label">College Year</span>
                    <p class="user-info-text"><%= student.collegeyear || "Not Provided" %></p>
                </div>
                <div class="user-clg-roll-wrapper">
                    <span class="input-label">College Roll</span>
                    <p class="user-info-text changable" data-field="Roll Number" data-name="rollnumber"><%= student.rollnumber || "Not Provided" %> 
                        <%- !visiting ? `
                        <button class="edit-btn inline-edit" onclick="changeDetail(this)" data-field="Roll Number" data-name="rollnumber">
                            <svg class="edit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-2.5-9.5L20 7m-2-5L13 7" stroke="#07192D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>` : '' %>
                    </p>
                </div>
            </div>
            <div class="p-info__third-row">
                <div class="user-fav-sub-wrapper">
                    <span class="input-label">Favourite Subject</span>
                    <p class="user-info-text changable" data-field="Favourite Subject" data-name="favouritesubject"><%= student.favouritesubject || "Not Provided" %> 
                        <%- !visiting ? `
                        <button class="edit-btn inline-edit" onclick="changeDetail(this)" data-field="Favourite Subject" data-name="favouritesubject">
                            <svg class="edit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-2.5-9.5L20 7m-2-5L13 7" stroke="#07192D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>` : '' %>
                    </p>
                </div>
                <div class="user-non-fav-sub-wrapper">
                    <span class="input-label">Not So Favourite Subject</span>
                    <p class="user-info-text changable" data-field="Non-Favourite Subject" data-name="notfavsubject"><%= student.notfavsubject || "Not Provided" %> 
                        <%- !visiting ? `
                        <button class="edit-btn inline-edit" onclick="changeDetail(this)" data-field="Non-Favourite Subject" data-name="notfavsubject">
                            <svg class="edit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-2.5-9.5L20 7m-2-5L13 7" stroke="#07192D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>` : '' %>
                    </p>
                </div>
            </div>
        </div>

        <div class="uploaded-notes-section">
            <div class="toggle-header-uploaded-notes">
                <% if (visiting) { %>
                    <button class="tab active-section" id="ownedNotes" data-username="<%= student.username %>">
                        <%= student.displayname.match(/^\S+/i) %>'s Notes
                    </button>
                <% } else { %>
                    <button class="tab active-section" id="ownedNotes" data-username="<%= student.username %>">My Notes</button>
                    <button class="tab" id="savedNotes">Saved Notes</button>
                <% } %>
            </div>
            <div class="notes-container visible-container" id="owned-notes-content">
                <div class="notes-loading">
                    <div class="loader"></div>
                    <p>Getting your notes...</p>
                </div>
                <div class="no-notes-content" id="no-notes-owned" style='display: none;'>
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p>No Notes to Show</p>
                </div>
            </div>
            <% if(!visiting) { %>
                <div class="sv-notes-container not-show" id="saved-notes-content">
                    <div class="no-notes-content" id="no-notes-saved">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <p>No Saved Notes to Show</p>
                    </div>
                </div>
            <% } %>
        </div>
    </div>

    <%- include('side-panel', { block: 'right-panel' }) %>
    <%- include('side-panel', { block: 'notification-modal' }) %>
    <%- include('side-panel', { block: 'mbl-ctrl-panel' }) %>
    <%- include('side-panel', { block: 'request-modal' }) %>

    <audio id="notificationAudio" src="/sounds/notification-ping-sound.mp3" preload="auto"></audio>

    <script src="/js/notificationHandler.js" defer></script>
    <script src="/js/onboarding-data.js" defer></script>
    <script src="/js/controller.js" defer></script> 
    <script src="/js/user-profile.js" defer></script> 
    <script src="/js/utils.js" defer></script> 
    <script src="/js/request.js" defer></script>
</body>
</html>